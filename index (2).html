<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEXIçš„ç½‘ç›˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: #0d0d1a;
            background-image: 
                radial-gradient(circle, #ffffff 1px, transparent 1px),
                radial-gradient(circle, #ffffff 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
            color: #e6e6e6;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
        }
        
        .container {
            background: rgba(18, 18, 30, 0.85);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 30px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            color: #ffffff;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(66, 153, 225, 0.5);
        }
        
        /* æ–°å¢ï¼šè¯·å–å’–å•¡æŒ‰é’®æ ·å¼ */
        .coffee-btn {
            display: block;
            margin: 0 auto 20px;
            padding: 10px 25px;
            background: #fbbf24;
            color: #12121e;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .coffee-btn:hover {
            background: #f59e0b;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }
        
        .subtitle {
            text-align: center;
            color: #b0b0cc;
            margin-bottom: 30px;
            font-size: 15px;
        }
        
        .release-section {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .release-title {
            color: #4299e1;
            margin: 25px 0 15px;
            font-size: 20px;
            padding-left: 10px;
            border-left: 4px solid #4299e1;
        }
        
        .file-item {
            border: 1px solid rgba(66, 153, 225, 0.2);
            background-color: rgba(25, 25, 40, 0.7);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(66, 153, 225, 0.15);
            border-color: #4299e1;
        }
        
        .file-item h3 {
            margin: 0 0 12px 0;
            color: #ffffff;
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        
        .file-item h3::before {
            content: "ğŸ“„";
            margin-right: 10px;
        }
        
        .file-info {
            color: #b0b0cc;
            margin-bottom: 15px;
            font-size: 14px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .file-info span {
            display: flex;
            align-items: center;
        }
        
        .file-info span::before {
            margin-right: 5px;
        }
        
        .file-info span:first-child::before {
            content: "ğŸ“Š";
        }
        
        .file-info span:last-child::before {
            content: "â±ï¸";
        }
        
        a {
            display: inline-block;
            margin-right: 12px;
            padding: 10px 20px;
            background: #4299e1;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }
        
        a:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }
        
        .high-speed {
            background: #38b2ac;
        }
        
        .high-speed:hover {
            background: #319795;
            box-shadow: 0 4px 12px rgba(56, 178, 172, 0.4);
        }
        
        .error {
            color: #ff6b6b;
            font-weight: 600;
            text-align: center;
            padding: 20px;
            background-color: rgba(239, 68, 68, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            margin: 20px 0;
        }
        
        #loading {
            text-align: center;
            padding: 40px;
            color: #b0b0cc;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        #loading::after {
            content: "";
            width: 20px;
            height: 20px;
            border: 3px solid #4299e1;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* è®¨è®ºåŒºæ ·å¼ */
        .discussions-section {
            margin-top: 50px;
        }
        
        .discussion-item {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: rgba(25, 25, 40, 0.7);
            transition: all 0.3s ease;
        }
        
        .discussion-item:hover {
            border-color: rgba(66, 153, 225, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .discussion-title {
            color: #63b3ed;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .discussion-meta {
            color: #b0b0cc;
            font-size: 13px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ç«™ä¸»æ ‡ç­¾æ ·å¼ */
        .owner-badge {
            background-color: #e53e3e;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* ç¼–ç é€‰æ‹©å™¨æ ·å¼ */
        .encoding-selector {
            margin: 10px 0;
            padding: 8px 12px;
            background: rgba(25, 25, 40, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e6e6e6;
            cursor: pointer;
        }
        
        .encoding-selector option {
            background: #12121e;
            color: #e6e6e6;
        }
        
        /* æ–°å¢ï¼šæ”¶æ¬¾ç å¼¹çª—æ ·å¼ */
        .qrcode-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(25, 25, 40, 0.95);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(251, 191, 36, 0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .modal-title {
            color: #fbbf24;
            font-size: 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .modal-title::before,
        .modal-title::after {
            content: "â˜•";
        }
        
        .modal-qrcode-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }
        
        .modal-qrcode-item {
            text-align: center;
        }
        
        .modal-qrcode-img {
            width: 180px;
            height: 180px;
            border-radius: 8px;
            object-fit: cover;
            background: white;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .modal-qrcode-desc {
            color: #d1d5db;
            font-size: 14px;
        }
        
        .modal-note {
            color: #b0b0cc;
            font-size: 13px;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .close-modal {
            padding: 10px 30px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .close-modal:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }
        
        /* å“åº”å¼é€‚é…æ‰‹æœº */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .file-item {
                padding: 15px;
            }
            
            a {
                width: 100%;
                margin: 0 0 10px 0;
                text-align: center;
            }
            
            .file-info {
                flex-direction: column;
                gap: 5px;
            }
            
            .modal-qrcode-container {
                gap: 20px;
            }
            
            .modal-qrcode-img {
                width: 150px;
                height: 150px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CEXIçš„ç½‘ç›˜</h1>
        
        <!-- æ–°å¢ï¼šè¯·ä½œè€…å–coffeeæŒ‰é’® -->
        <button class="coffee-btn" id="coffeeBtn">
            â˜• è¯·ä½œè€…å–coffee
        </button>
        
        <div class="subtitle">ä½œè€…åšå®¢ | cexi2394.github.io</div>
        
        <div id="loading">æ­£åœ¨åŠ è½½æ–‡ä»¶... </div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="file-list"></div>
        
        <!-- è®¨è®ºåŒºå®¹å™¨ -->
        <div class="discussions-section">
            <h3 class="release-title">ğŸ’¬ è®¨è®ºåŒº</h3>
            <select id="encoding-select" class="encoding-selector" style="display: none;">
                <option value="utf-8">UTF-8ï¼ˆé»˜è®¤ï¼‰</option>
                <option value="gbk">GBKï¼ˆä¸­æ–‡Windowsé»˜è®¤ï¼‰</option>
                <option value="gb2312">GB2312ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰</option>
                <option value="gb18030">GB18030ï¼ˆæ‰©å±•ä¸­æ–‡ï¼‰</option>
                <option value="iso-8859-1">ANSIï¼ˆè‹±æ–‡ï¼‰</option>
            </select>
            <div id="discussions-loading" style="display: flex; justify-content: center; padding: 20px;">
                <div style="display: flex; align-items: center; gap: 10px; color: #b0b0cc;">
                    <div style="width: 16px; height: 16px; border: 2px solid #4299e1; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    åŠ è½½è®¨è®ºä¸­...
                </div>
            </div>
            <div id="discussions-error" class="error" style="display: none;"></div>
            <div id="discussions-container"></div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šæ”¶æ¬¾ç å¼¹çª— -->
    <div class="qrcode-modal" id="qrcodeModal">
        <div class="modal-content">
            <h3 class="modal-title">æ„Ÿè°¢æ”¯æŒ Â· å–æ¯å’–å•¡å§ï½</h3>
            <div class="modal-qrcode-container">
                <!-- å¾®ä¿¡æ”¶æ¬¾ç ï¼ˆæ›¿æ¢ä¸ºä½ çš„çœŸå®åœ°å€ï¼‰ -->
                <div class="modal-qrcode-item">
                    <img src="https://raw.githubusercontent.com/CEXI2394/yunpan/main/qrcode/all.yuan.png" alt="å¾®ä¿¡æ”¶æ¬¾ç " class="modal-qrcode-img" id="wechat-qrcode">
                    <p class="modal-qrcode-desc">å¾®ä¿¡æ”¯ä»˜</p>
                </div>
                <!-- 10å…ƒå¾®ä¿¡æ”¶æ¬¾ç ï¼ˆæ›¿æ¢ä¸ºä½ çš„çœŸå®åœ°å€ï¼‰ -->
                <div class="modal-qrcode-item">
                    <img src="https://raw.githubusercontent.com/CEXI2394/yunpan/main/qrcode/10yuan.png" alt="10å…ƒå¾®ä¿¡æ”¶æ¬¾ç " class="modal-qrcode-img" id="alipay-qrcode">
                    <p class="modal-qrcode-desc">10å…ƒå¾®ä¿¡æ”¶æ¬¾ç </p>
                </div>
            </div>
            <p class="modal-note">
                æ‚¨çš„æ”¯æŒæ˜¯æˆ‘æŒç»­æ›´æ–°çš„åŠ¨åŠ›ï¼<br>
                æ‰“èµæ—¶å¯å¤‡æ³¨éœ€æ±‚ï¼Œä¼˜å…ˆå¤„ç†ï½
            </p>
            <button class="close-modal" id="closeModal">å…³é—­</button>
        </div>
    </div>

    <script>
        // é…ç½®ä¿¡æ¯
        const GITHUB_TOKEN = "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"; // ä½ çš„GitHubä»¤ç‰Œ
        const GITHUB_USER = "cexi2394"; // ä½ çš„GitHubç”¨æˆ·å
        const GITHUB_REPO = "yunpan";       // ä½ çš„ä»“åº“å

        // APIåœ°å€
        const RELEASES_API = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/releases`;
        const DISCUSSION_FILE_API = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/taolun.txt?ref=main`;
        const ACCELERATE_DOMAIN = "https://gitproxy.click";

        // å…¨å±€å˜é‡å­˜å‚¨åŸå§‹base64å†…å®¹ï¼ˆç”¨äºåˆ‡æ¢ç¼–ç ï¼‰
        let rawBase64Content = "";

        // æ–°å¢ï¼šå¼¹çª—æ§åˆ¶
        const coffeeBtn = document.getElementById("coffeeBtn");
        const qrcodeModal = document.getElementById("qrcodeModal");
        const closeModal = document.getElementById("closeModal");

        // ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå¼¹çª—
        coffeeBtn.addEventListener("click", () => {
            qrcodeModal.style.display = "flex";
        });

        // ç‚¹å‡»å…³é—­æŒ‰é’®éšè—å¼¹çª—
        closeModal.addEventListener("click", () => {
            qrcodeModal.style.display = "none";
        });

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨ç©ºç™½å¤„éšè—å¼¹çª—
        qrcodeModal.addEventListener("click", (e) => {
            if (e.target === qrcodeModal) {
                qrcodeModal.style.display = "none";
            }
        });

        // æŒ‰ESCé”®å…³é—­å¼¹çª—
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && qrcodeModal.style.display === "flex") {
                qrcodeModal.style.display = "none";
            }
        });

        // é¡µé¢åŠ è½½åæ‰§è¡Œ
        window.onload = async function() {
            const loadingEl = document.getElementById("loading");
            const errorEl = document.getElementById("error");
            const fileListEl = document.getElementById("file-list");

            try {
                // åŠ è½½Releases
                const response = await fetch(RELEASES_API, {
                    method: "GET",
                    headers: {
                        "Authorization": `token ${GITHUB_TOKEN}`,
                        "Accept": "application/vnd.github.v3+json",
                        "User-Agent": "GitHub-Pan-App"
                    }
                });

                if (!response.ok) {
                    switch(response.status) {
                        case 401:
                            showError("ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸï¼è¯·é‡æ–°ç”Ÿæˆä»¤ç‰Œ");
                            break;
                        case 403:
                            showError("APIè®¿é—®æ¬¡æ•°è¶…é™ï¼è¯·1å°æ—¶åå†è¯•");
                            break;
                        case 404:
                            showError("ä»“åº“ä¸å­˜åœ¨ï¼è¯·æ£€æŸ¥ç”¨æˆ·åå’Œä»“åº“å");
                            break;
                        default:
                            showError(`è¯·æ±‚å¤±è´¥ï¼š${response.status} - ${response.statusText}`);
                    }
                    return;
                }

                const releases = await response.json();

                if (releases.length === 0) {
                    showError("ä½ çš„ä»“åº“æ²¡æœ‰Releasesï¼è¯·å…ˆä¸Šä¼ æ–‡ä»¶åˆ°Releases");
                    return;
                }

                // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºæ–‡ä»¶
                loadingEl.style.display = "none";
                renderAllReleases(releases);
                
                // åŠ è½½è®¨è®ºï¼ˆä»taolun.txtè¯»å–ï¼‰
                await loadDiscussionsFromFile();

                // ç»‘å®šç¼–ç åˆ‡æ¢äº‹ä»¶
                document.getElementById("encoding-select").addEventListener("change", function(e) {
                    if (rawBase64Content) {
                        const content = decodeWithEncoding(rawBase64Content, e.target.value);
                        renderDiscussions(content);
                    }
                });

            } catch (error) {
                showError("ç½‘ç»œé”™è¯¯ï¼è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä»£ç†æ˜¯å¦æœ‰æ•ˆ");
                console.error("é”™è¯¯è¯¦æƒ…ï¼š", error);
            }

            function showError(msg) {
                loadingEl.style.display = "none";
                document.getElementById("discussions-loading").style.display = "none";
                errorEl.style.display = "block";
                errorEl.innerText = "âŒ " + msg;
            }
        };

        // æ¸²æŸ“æ‰€æœ‰Release
        function renderAllReleases(releases) {
            const fileListEl = document.getElementById("file-list");
            
            releases.forEach(release => {
                const releaseSection = document.createElement("div");
                releaseSection.className = "release-section";
                
                const releaseTitle = document.createElement("h3");
                releaseTitle.className = "release-title";
                releaseTitle.innerText = `ğŸ“¦ ${release.name || 'æœªå‘½åå‘å¸ƒ'} (å‘å¸ƒäº: ${formatTime(release.published_at)})`;
                releaseSection.appendChild(releaseTitle);
                
                const files = release.assets;
                if (files.length > 0) {
                    files.forEach(file => {
                        const fileItem = document.createElement("div");
                        fileItem.className = "file-item";
                        fileItem.innerHTML = `
                            <h3>${file.name}</h3>
                            <div class="file-info">
                                <span>å¤§å°ï¼š${formatFileSize(file.size)}</span>
                                <span>ä¸Šä¼ æ—¶é—´ï¼š${formatTime(file.created_at)}</span>
                            </div>
                            <a href="${file.browser_download_url}" target="_blank">ç›´æ¥ä¸‹è½½</a>
                            <a href="${ACCELERATE_DOMAIN}/${file.browser_download_url}" class="high-speed" target="_blank">é«˜é€Ÿä¸‹è½½</a>
                        `;
                        releaseSection.appendChild(fileItem);
                    });
                } else {
                    const noFileMsg = document.createElement("p");
                    noFileMsg.style.color = "#b0b0cc";
                    noFileMsg.style.padding = "15px";
                    noFileMsg.innerText = "æ­¤å‘å¸ƒä¸­æ²¡æœ‰æ–‡ä»¶";
                    releaseSection.appendChild(noFileMsg);
                }
                
                fileListEl.appendChild(releaseSection);
            });
        }

        // ä»taolun.txtåŠ è½½è®¨è®ºï¼ˆæ”¯æŒå¤šç¼–ç ï¼‰
        async function loadDiscussionsFromFile() {
            const discussionsLoading = document.getElementById("discussions-loading");
            const discussionsContainer = document.getElementById("discussions-container");
            const discussionsError = document.getElementById("discussions-error");
            const encodingSelect = document.getElementById("encoding-select");
            
            try {
                const response = await fetch(DISCUSSION_FILE_API, {
                    method: "GET",
                    headers: {
                        "Authorization": `token ${GITHUB_TOKEN}`,
                        "Accept": "application/vnd.github.v3+json",
                        "User-Agent": "GitHub-Pan-App"
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        discussionsLoading.style.display = "none";
                        const noFileMsg = document.createElement("p");
                        noFileMsg.style.textAlign = "center";
                        noFileMsg.style.padding = "20px";
                        noFileMsg.style.color = "#b0b0cc";
                        noFileMsg.innerText = "è®¨è®ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·åœ¨ä»“åº“mainåˆ†æ”¯åˆ›å»ºtaolun.txt";
                        discussionsContainer.appendChild(noFileMsg);
                        return;
                    }
                    throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const fileData = await response.json();
                rawBase64Content = fileData.content; // ä¿å­˜åŸå§‹base64å†…å®¹
                discussionsLoading.style.display = "none";
                
                // å°è¯•è‡ªåŠ¨è¯†åˆ«ç¼–ç å¹¶è§£ç 
                let decodedContent = autoDetectEncoding(rawBase64Content);
                
                // æ˜¾ç¤ºç¼–ç é€‰æ‹©å™¨
                encodingSelect.style.display = "block";
                
                // æ¸²æŸ“è®¨è®º
                renderDiscussions(decodedContent);
                
            } catch (error) {
                discussionsLoading.style.display = "none";
                discussionsError.style.display = "block";
                discussionsError.innerText = "âŒ åŠ è½½è®¨è®ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";
                console.error("è®¨è®ºåŠ è½½é”™è¯¯:", error);
            }
        }

        // è‡ªåŠ¨è¯†åˆ«ç¼–ç ï¼ˆUTF-8ä¼˜å…ˆï¼Œå¤±è´¥åˆ™å°è¯•å…¶ä»–ç¼–ç ï¼‰
        function autoDetectEncoding(base64Content) {
            // å…ˆå°è¯•UTF-8
            let content = decodeWithEncoding(base64Content, "utf-8");
            if (isValidChinese(content)) {
                document.getElementById("encoding-select").value = "utf-8";
                return content;
            }
            
            // UTF-8å¤±è´¥ï¼Œå°è¯•GBK
            content = decodeWithEncoding(base64Content, "gbk");
            if (isValidChinese(content)) {
                document.getElementById("encoding-select").value = "gbk";
                return content;
            }
            
            // GBKå¤±è´¥ï¼Œå°è¯•GB2312
            content = decodeWithEncoding(base64Content, "gb2312");
            if (isValidChinese(content)) {
                document.getElementById("encoding-select").value = "gb2312";
                return content;
            }
            
            // æœ€åå°è¯•GB18030
            content = decodeWithEncoding(base64Content, "gb18030");
            document.getElementById("encoding-select").value = "gb18030";
            return content;
        }

        // æ ¹æ®æŒ‡å®šç¼–ç è§£ç base64å†…å®¹
        function decodeWithEncoding(base64Content, encoding) {
            // è§£ç base64ä¸ºUint8Array
            const binaryString = atob(base64Content);
            const uint8Array = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                uint8Array[i] = binaryString.charCodeAt(i);
            }
            
            // æ ¹æ®ç¼–ç è§£ç 
            try {
                switch(encoding) {
                    case "utf-8":
                        return new TextDecoder("utf-8", { fatal: true }).decode(uint8Array);
                    case "gbk":
                        return new TextDecoder("gbk", { fatal: true }).decode(uint8Array);
                    case "gb2312":
                        return new TextDecoder("gb2312", { fatal: true }).decode(uint8Array);
                    case "gb18030":
                        return new TextDecoder("gb18030", { fatal: true }).decode(uint8Array);
                    case "iso-8859-1":
                        return new TextDecoder("iso-8859-1").decode(uint8Array);
                    default:
                        return new TextDecoder("utf-8").decode(uint8Array);
                }
            } catch (e) {
                // è§£ç å¤±è´¥æ—¶è¿”å›åŸå§‹å­—ç¬¦ä¸²
                return binaryString;
            }
        }

        // åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆä¸­æ–‡ï¼ˆæ’é™¤ä¹±ç ï¼‰
        function isValidChinese(str) {
            // ä¸­æ–‡æ­£åˆ™ï¼ˆåŒ…å«å¸¸è§ä¸­æ–‡ã€æ ‡ç‚¹ï¼‰
            const chineseRegex = /[\u4e00-\u9fa5\u3000-\u303f\uff00-\uffef]/;
            // ä¹±ç ç‰¹å¾ï¼šè¿ç»­çš„ASCIIæ§åˆ¶å­—ç¬¦æˆ–æ— æ„ä¹‰å­—ç¬¦
            const garbleRegex = /[\x00-\x1f\x7f-\xff]{5,}/;
            
            return chineseRegex.test(str) && !garbleRegex.test(str);
        }

        // æ¸²æŸ“è®¨è®ºå†…å®¹
        function renderDiscussions(content) {
            const discussionsContainer = document.getElementById("discussions-container");
            discussionsContainer.innerHTML = ""; // æ¸…ç©ºç°æœ‰å†…å®¹
            
            // è§£æè®¨è®ºå†…å®¹
            const discussionItems = parseDiscussionText(content);
            
            if (discussionItems.length === 0) {
                const noContentMsg = document.createElement("p");
                noContentMsg.style.textAlign = "center";
                noContentMsg.style.padding = "20px";
                noContentMsg.style.color = "#b0b0cc";
                noContentMsg.innerText = "è®¨è®ºåŒºæš‚æ— å†…å®¹";
                discussionsContainer.appendChild(noContentMsg);
                return;
            }
            
            // æ¸²æŸ“æ¯ä¸ªè®¨è®º
            discussionItems.forEach((item, index) => {
                // æ£€æŸ¥æ˜¯å¦æ˜¯ç«™ä¸»ï¼ˆCEXI2394ï¼‰å‘å¸ƒçš„å†…å®¹
                const isOwner = item.author && item.author.toLowerCase() === "cexi2394";
                
                const discussionItem = document.createElement("div");
                discussionItem.className = "discussion-item";
                
                // æ„å»ºä½œè€…ä¿¡æ¯ï¼ˆåŒ…å«ç«™ä¸»æ ‡ç­¾ï¼‰
                const authorHtml = isOwner 
                    ? `${item.author || 'åŒ¿å'} <span class="owner-badge">ç«™ä¸»</span>`
                    : item.author || 'åŒ¿å';
                
                discussionItem.innerHTML = `
                    <h4 class="discussion-title">è®¨è®º #${index + 1}: ${item.title || 'æ— æ ‡é¢˜'}</h4>
                    <div class="discussion-meta">
                        ä½œè€…ï¼š${authorHtml} Â· å‘å¸ƒäº ${item.date || 'æœªçŸ¥æ—¶é—´'}
                    </div>
                    <div style="color:#d1d5db; font-size:14px; line-height:1.6; white-space: pre-line;">
                        ${item.content.trim()}
                    </div>
                `;
                discussionsContainer.appendChild(discussionItem);
            });
        }

        // è§£ætaolun.txtå†…å®¹ï¼ˆæ”¯æŒçµæ´»æ ¼å¼ï¼‰
        function parseDiscussionText(content) {
            const lines = content.split('\n').map(line => line.trim());
            const discussions = [];
            let currentDiscussion = { 
                title: 'æ— æ ‡é¢˜', 
                date: 'æœªçŸ¥æ—¶é—´', 
                author: '', 
                content: '' 
            };
            
            lines.forEach(line => {
                if (line === '') {
                    // ç©ºè¡Œåˆ†éš”ä¸åŒè®¨è®ºï¼ˆå†…å®¹ä¸ä¸ºç©ºæ‰æ·»åŠ ï¼‰
                    if (currentDiscussion.content.trim()) {
                        discussions.push(currentDiscussion);
                        currentDiscussion = { 
                            title: 'æ— æ ‡é¢˜', 
                            date: 'æœªçŸ¥æ—¶é—´', 
                            author: '', 
                            content: '' 
                        };
                    }
                } else if (line.includes(':')) {
                    // æ”¯æŒçµæ´»çš„é”®åï¼ˆä¸åŒºåˆ†å¤§å°å†™ã€ç©ºæ ¼ï¼‰
                    const [key, value] = line.split(':', 2).map(p => p.trim());
                    const keyLower = key.toLowerCase().replace(/\s+/g, '');
                    
                    if (keyLower.includes('æ ‡é¢˜')) {
                        currentDiscussion.title = value || currentDiscussion.title;
                    } else if (keyLower.includes('æ—¥æœŸ') || keyLower.includes('æ—¶é—´')) {
                        currentDiscussion.date = value || currentDiscussion.date;
                    } else if (keyLower.includes('ä½œè€…') || keyLower.includes('å‘å¸ƒè€…')) {
                        currentDiscussion.author = value || currentDiscussion.author;
                    } else if (keyLower.includes('ç”¨æˆ·å')) {
                        currentDiscussion.author = value || currentDiscussion.author;
                    } else {
                        // å…¶ä»–å¸¦å†’å·çš„è¡Œè§†ä¸ºå†…å®¹
                        currentDiscussion.content += line + '\n';
                    }
                } else {
                    // æ™®é€šå†…å®¹è¡Œ
                    currentDiscussion.content += line + '\n';
                }
            });
            
            // æ·»åŠ æœ€åä¸€ä¸ªè®¨è®ºï¼ˆå¦‚æœæœ‰å†…å®¹ï¼‰
            if (currentDiscussion.content.trim()) {
                discussions.push(currentDiscussion);
            }
            
            return discussions;
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes >= 1024 * 1024) {
                return (bytes / (1024 * 1024)).toFixed(2) + " MB";
            } else if (bytes >= 1024) {
                return (bytes / 1024).toFixed(2) + " KB";
            } else {
                return bytes + " B";
            }
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(isoTime) {
            const date = new Date(isoTime);
            return date.toLocaleString();
        }
    </script>
</body>
</html>